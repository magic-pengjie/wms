<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.magic.card.wms.baseset.mapper.OrderInfoMapper">
    <sql id="orderCommodityInfoSQL">
        SELECT
            woc.order_no orderNo,
            woc.customer_code customer,
            woc.bar_code barCode,
            wcs.sku_name skuName,
            woc.numbers bayNums,
            wcs.single_weight singleWeigh,
            wcs.single_weight_unit singleWeightUnit,
            wcshc.bar_code useBarCode,
            wcshc.sku_name useSkuName,
            wcshc.single_weight useSigleWeight,
            wcshc.single_weight_unit useSigleWeightUnit,
            wccc.left_value leftValue,
            wccc.right_value rightValue,
            wccc.use_nums useNums
        FROM
            wms_order_info woi
            LEFT JOIN wms_order_commodity woc ON woi.order_no = woc.order_no AND woi.customer_code = woc.customer_code
            LEFT JOIN wms_customer_base_info wcbi ON wcbi.customer_code = woi.customer_code
            LEFT JOIN wms_commodity_info wci ON wci.customer_id = wcbi.id  AND wci.commodity_code = woc.bar_code
            LEFT JOIN wms_commodity_consumables_config wccc ON wccc.commodity_id = wci.id
            LEFT JOIN wms_commodity_info wcihc ON wccc.use_commodity_id = wcihc.id
            LEFT JOIN wms_commodity_sku wcs ON wcs.bar_code = wci.commodity_code
            LEFT JOIN wms_commodity_sku wcshc ON wcshc.bar_code = wcihc.commodity_code
    </sql>
    <select id="orderCommodityWeightMap" resultType="java.util.Map">
        <include refid="orderCommodityInfoSQL"/>
        WHERE
            woc.order_no = #{orderNo} AND woc.customer_code = #{customerCode}
    </select>
    <select id="loadGrid" resultType="java.util.Map">
        SELECT
            woi.id,
            woi.order_no orderNo,
            woi.customer_code customerCode,
            wcbi.customer_name customerName,
            woi.recipt_name reciptName,
            woi.recipt_phone reciptPhone,
            woi.recipt_addr reciptAddr,
            woi.express_key expressKey,
            woi.is_b2b isB2b,
            woi.bill_state billState,
            woi.create_time createTime
        FROM
            wms_order_info woi
            LEFT JOIN wms_customer_base_info wcbi ON woi.customer_code = wcbi.customer_code
        <where>
            ${ew.sqlSegment}
        </where>
    </select>
    <select id="orderPackage" resultType="java.util.Map">
        <include refid="orderCommodityInfoSQL"/>
        WHERE woc.order_no = #{orderNo}
    </select>
</mapper>
